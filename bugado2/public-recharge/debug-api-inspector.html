<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç Debug - API Inspector</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: #4ec9b0;
            border-bottom: 2px solid #4ec9b0;
            padding-bottom: 10px;
        }
        h2 {
            color: #569cd6;
            margin-top: 30px;
        }
        .section {
            background: #252526;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            border-left: 4px solid #007acc;
        }
        .success {
            border-left-color: #4ec9b0;
        }
        .error {
            border-left-color: #f48771;
        }
        .warning {
            border-left-color: #dcdcaa;
        }
        pre {
            background: #1e1e1e;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
            border: 1px solid #3c3c3c;
        }
        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        .badge-success {
            background: #4ec9b0;
            color: #000;
        }
        .badge-error {
            background: #f48771;
            color: #000;
        }
        .badge-warning {
            background: #dcdcaa;
            color: #000;
        }
        button {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover {
            background: #005a9e;
        }
        .code {
            color: #ce9178;
        }
        .key {
            color: #9cdcfe;
        }
        .value {
            color: #b5cea8;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç API Inspector - Debug GesOffice</h1>
        
        <div id="results"></div>
        
        <button onclick="runInspection()">üîÑ Executar Inspe√ß√£o Completa</button>
        <button onclick="testApiCalls()">üß™ Testar Chamadas API</button>
    </div>

    <!-- Importar o api.js do projeto -->
    <script src="/js/shared/api.js"></script>

    <script>
        function log(title, content, type = 'section') {
            const results = document.getElementById('results');
            const section = document.createElement('div');
            section.className = `section ${type}`;
            
            let badge = '';
            if (type === 'success') badge = '<span class="badge badge-success">‚úì OK</span>';
            if (type === 'error') badge = '<span class="badge badge-error">‚úó ERRO</span>';
            if (type === 'warning') badge = '<span class="badge badge-warning">‚ö† AVISO</span>';
            
            section.innerHTML = `<h2>${title} ${badge}</h2><pre>${content}</pre>`;
            results.appendChild(section);
        }

        function runInspection() {
            document.getElementById('results').innerHTML = '';
            
            console.log('üîç Iniciando inspe√ß√£o...');
            
            // ============================================
            // 1. VERIFICAR SE API EXISTE
            // ============================================
            if (typeof API === 'undefined') {
                log('1. Objeto API', '‚ùå ERRO: Objeto API n√£o est√° definido!\n\nO arquivo api.js n√£o foi carregado ou tem erro de sintaxe.', 'error');
                return;
            } else {
                log('1. Objeto API', '‚úÖ Objeto API existe\nTipo: ' + typeof API, 'success');
            }
            
            // ============================================
            // 2. VERIFICAR API.admin
            // ============================================
            if (typeof API.admin === 'undefined') {
                log('2. API.admin', '‚ùå ERRO: API.admin n√£o est√° definido!', 'error');
                return;
            } else {
                log('2. API.admin', '‚úÖ API.admin existe\nTipo: ' + typeof API.admin, 'success');
            }
            
            // ============================================
            // 3. LISTAR TODOS OS M√âTODOS DE API.admin
            // ============================================
            const adminMethods = Object.keys(API.admin).sort();
            
            let methodsList = `Total de m√©todos: ${adminMethods.length}\n\n`;
            
            // Agrupar por categoria
            const sigma = adminMethods.filter(m => m.includes('Panel') && !m.includes('Koffice') && !m.includes('GesOffice'));
            const koffice = adminMethods.filter(m => m.includes('Koffice'));
            const gesoffice = adminMethods.filter(m => m.includes('GesOffice'));
            const others = adminMethods.filter(m => !sigma.includes(m) && !koffice.includes(m) && !gesoffice.includes(m));
            
            methodsList += 'üìä M√©todos Sigma:\n';
            sigma.forEach(m => methodsList += `  - ${m}\n`);
            
            methodsList += '\nüìä M√©todos Koffice:\n';
            koffice.forEach(m => methodsList += `  - ${m}\n`);
            
            methodsList += '\nüìä M√©todos GesOffice:\n';
            if (gesoffice.length === 0) {
                methodsList += '  ‚ùå NENHUM M√âTODO GESOFFICE ENCONTRADO!\n';
            } else {
                gesoffice.forEach(m => methodsList += `  - ${m}\n`);
            }
            
            methodsList += '\nüìä Outros m√©todos:\n';
            others.forEach(m => methodsList += `  - ${m}\n`);
            
            log('3. M√©todos de API.admin', methodsList, gesoffice.length === 0 ? 'error' : 'success');
            
            // ============================================
            // 4. VERIFICAR M√âTODOS ESPEC√çFICOS GESOFFICE
            // ============================================
            const requiredMethods = [
                'getGesOfficePanels',
                'createGesOfficePanel',
                'updateGesOfficePanel',
                'deleteGesOfficePanel',
                'getGesOfficeResellers',
                'createGesOfficeReseller',
                'updateGesOfficeReseller',
                'deleteGesOfficeReseller'
            ];
            
            let methodCheck = '';
            let allPresent = true;
            
            requiredMethods.forEach(method => {
                const exists = typeof API.admin[method] === 'function';
                methodCheck += `${exists ? '‚úÖ' : '‚ùå'} ${method}: ${exists ? 'function' : 'undefined'}\n`;
                if (!exists) allPresent = false;
            });
            
            log('4. M√©todos GesOffice Necess√°rios', methodCheck, allPresent ? 'success' : 'error');
            
            // ============================================
            // 5. VERIFICAR ESTRUTURA DE UM M√âTODO
            // ============================================
            if (typeof API.admin.getGesOfficePanels === 'function') {
                const fnString = API.admin.getGesOfficePanels.toString();
                log('5. Estrutura de getGesOfficePanels', fnString, 'success');
            } else {
                log('5. Estrutura de getGesOfficePanels', '‚ùå M√©todo n√£o √© uma fun√ß√£o!', 'error');
            }
            
            // ============================================
            // 6. VERIFICAR SE H√Å ERROS DE SINTAXE
            // ============================================
            try {
                const test = JSON.stringify(API.admin, null, 2);
                log('6. Teste de Sintaxe', '‚úÖ Sem erros de sintaxe no objeto API.admin', 'success');
            } catch (e) {
                log('6. Teste de Sintaxe', `‚ùå ERRO: ${e.message}`, 'error');
            }
            
            // ============================================
            // 7. VERIFICAR ORDEM DE CARREGAMENTO
            // ============================================
            const scripts = Array.from(document.scripts).map(s => s.src || s.innerHTML.substring(0, 50));
            let scriptsInfo = 'Scripts carregados:\n\n';
            scripts.forEach((s, i) => {
                scriptsInfo += `${i + 1}. ${s}\n`;
            });
            log('7. Scripts Carregados', scriptsInfo, 'section');
            
            // ============================================
            // 8. VERIFICAR CONSOLE ERRORS
            // ============================================
            console.log('‚úÖ Inspe√ß√£o conclu√≠da! Verifique os resultados acima.');
        }

        async function testApiCalls() {
            if (typeof API === 'undefined' || typeof API.admin === 'undefined') {
                log('Teste de API', '‚ùå API n√£o est√° dispon√≠vel', 'error');
                return;
            }
            
            // Testar se getGesOfficePanels est√° dispon√≠vel
            if (typeof API.admin.getGesOfficePanels !== 'function') {
                log('Teste de Chamada', '‚ùå getGesOfficePanels n√£o √© uma fun√ß√£o!', 'error');
                return;
            }
            
            log('Teste de Chamada', 'üîÑ Tentando chamar API.admin.getGesOfficePanels()...', 'section');
            
            try {
                const result = await API.admin.getGesOfficePanels();
                log('Resultado da Chamada', 
                    `‚úÖ SUCESSO!\n\nResposta:\n${JSON.stringify(result, null, 2)}`, 
                    'success'
                );
            } catch (error) {
                log('Resultado da Chamada', 
                    `‚ùå ERRO AO CHAMAR API:\n\n${error.message}\n\nStack:\n${error.stack}`, 
                    'error'
                );
            }
        }
        
        // Executar automaticamente ao carregar
        window.addEventListener('load', () => {
            console.log('üîç Debug API Inspector carregado');
            console.log('Digite runInspection() no console ou clique no bot√£o para come√ßar');
        });
    </script>
</body>
</html>
